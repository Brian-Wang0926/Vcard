{"ast":null,"code":"import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n  function Logger(props) {\n    var _this;\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin({\n      maxSize: _this.editorConfig.loggerMaxSize\n    }); // 注册API\n\n    _this.editor.registerPluginApi('undo', _this.handleUndo);\n    _this.editor.registerPluginApi('redo', _this.handleRedo);\n    return _this;\n  }\n  var _proto = Logger.prototype;\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n  _proto.handleChange = function handleChange(value, e, isNotInput) {\n    var _this2 = this;\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n    this.logger.cleanRedo();\n    if (isNotInput) {\n      // from setText API call, not a input\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n        _this2.lastPop = null;\n        _this2.forceUpdate();\n      }\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, this.editorConfig.loggerInterval);\n  };\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n    this.editor.off('change', this.handleChange);\n    this.editor.unregisterPluginApi('undo');\n    this.editor.unregisterPluginApi('redo');\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n  return Logger;\n}(PluginComponent);\nLogger.pluginName = 'logger';\nexport { Logger as default };","map":{"version":3,"names":["_assertThisInitialized","_inheritsLoose","React","Icon","i18n","PluginComponent","LoggerPlugin","Logger","_PluginComponent","props","_this","call","handleKeyboards","lastPop","handleChange","bind","handleRedo","handleUndo","key","keyCode","withKey","callback","aliasCommand","logger","maxSize","editorConfig","loggerMaxSize","editor","registerPluginApi","_proto","prototype","last","undo","getMdValue","pause","setText","forceUpdate","redo","value","e","isNotInput","_this2","getLast","cleanRedo","push","timerId","window","clearTimeout","setTimeout","loggerInterval","componentDidMount","_this3","on","forEach","it","onKeyboard","initValue","componentWillUnmount","_this4","off","unregisterPluginApi","offKeyboard","undefined","render","hasUndo","getUndoCount","hasRedo","getRedoCount","createElement","Fragment","className","title","get","onClick","type","pluginName","default"],"sources":["/Users/wangbaiyuan/Documents/Wehelp/Part3/Vcard/client/node_modules/react-markdown-editor-lite/esm/plugins/logger/index.js"],"sourcesContent":["import _assertThisInitialized from \"@babel/runtime/helpers/assertThisInitialized\";\nimport _inheritsLoose from \"@babel/runtime/helpers/inheritsLoose\";\nimport * as React from 'react';\nimport Icon from '../../components/Icon';\nimport i18n from '../../i18n';\nimport { PluginComponent } from '../Plugin';\nimport LoggerPlugin from './logger';\n\nvar Logger = /*#__PURE__*/function (_PluginComponent) {\n  _inheritsLoose(Logger, _PluginComponent);\n\n  function Logger(props) {\n    var _this;\n\n    _this = _PluginComponent.call(this, props) || this;\n    _this.handleKeyboards = [];\n    _this.lastPop = null;\n    _this.handleChange = _this.handleChange.bind(_assertThisInitialized(_this));\n    _this.handleRedo = _this.handleRedo.bind(_assertThisInitialized(_this));\n    _this.handleUndo = _this.handleUndo.bind(_assertThisInitialized(_this)); // Mac的Redo比较特殊，是Command+Shift+Z，优先处理\n\n    _this.handleKeyboards = [{\n      key: 'y',\n      keyCode: 89,\n      withKey: ['ctrlKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      withKey: ['metaKey', 'shiftKey'],\n      callback: _this.handleRedo\n    }, {\n      key: 'z',\n      keyCode: 90,\n      aliasCommand: true,\n      withKey: ['ctrlKey'],\n      callback: _this.handleUndo\n    }];\n    _this.logger = new LoggerPlugin({\n      maxSize: _this.editorConfig.loggerMaxSize\n    }); // 注册API\n\n    _this.editor.registerPluginApi('undo', _this.handleUndo);\n\n    _this.editor.registerPluginApi('redo', _this.handleRedo);\n\n    return _this;\n  }\n\n  var _proto = Logger.prototype;\n\n  _proto.handleUndo = function handleUndo() {\n    var last = this.logger.undo(this.editor.getMdValue());\n\n    if (typeof last !== 'undefined') {\n      this.pause();\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleRedo = function handleRedo() {\n    var last = this.logger.redo();\n\n    if (typeof last !== 'undefined') {\n      this.lastPop = last;\n      this.editor.setText(last);\n      this.forceUpdate();\n    }\n  };\n\n  _proto.handleChange = function handleChange(value, e, isNotInput) {\n    var _this2 = this;\n\n    if (this.logger.getLast() === value || this.lastPop !== null && this.lastPop === value) {\n      return;\n    }\n\n    this.logger.cleanRedo();\n\n    if (isNotInput) {\n      // from setText API call, not a input\n      this.logger.push(value);\n      this.lastPop = null;\n      this.forceUpdate();\n      return;\n    }\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = 0;\n    }\n\n    this.timerId = window.setTimeout(function () {\n      if (_this2.logger.getLast() !== value) {\n        _this2.logger.push(value);\n\n        _this2.lastPop = null;\n\n        _this2.forceUpdate();\n      }\n\n      window.clearTimeout(_this2.timerId);\n      _this2.timerId = 0;\n    }, this.editorConfig.loggerInterval);\n  };\n\n  _proto.componentDidMount = function componentDidMount() {\n    var _this3 = this;\n\n    // 监听变化事件\n    this.editor.on('change', this.handleChange); // 监听键盘事件\n\n    this.handleKeyboards.forEach(function (it) {\n      return _this3.editor.onKeyboard(it);\n    }); // 初始化时，把已有值填充进logger\n\n    this.logger.initValue = this.editor.getMdValue();\n    this.forceUpdate();\n  };\n\n  _proto.componentWillUnmount = function componentWillUnmount() {\n    var _this4 = this;\n\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n    }\n\n    this.editor.off('change', this.handleChange);\n    this.editor.unregisterPluginApi('undo');\n    this.editor.unregisterPluginApi('redo');\n    this.handleKeyboards.forEach(function (it) {\n      return _this4.editor.offKeyboard(it);\n    });\n  };\n\n  _proto.pause = function pause() {\n    if (this.timerId) {\n      window.clearTimeout(this.timerId);\n      this.timerId = undefined;\n    }\n  };\n\n  _proto.render = function render() {\n    var hasUndo = this.logger.getUndoCount() > 1 || this.logger.initValue !== this.editor.getMdValue();\n    var hasRedo = this.logger.getRedoCount() > 0;\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-undo \" + (hasUndo ? '' : 'disabled'),\n      title: i18n.get('btnUndo'),\n      onClick: this.handleUndo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"undo\"\n    })), /*#__PURE__*/React.createElement(\"span\", {\n      className: \"button button-type-redo \" + (hasRedo ? '' : 'disabled'),\n      title: i18n.get('btnRedo'),\n      onClick: this.handleRedo\n    }, /*#__PURE__*/React.createElement(Icon, {\n      type: \"redo\"\n    })));\n  };\n\n  return Logger;\n}(PluginComponent);\n\nLogger.pluginName = 'logger';\nexport { Logger as default };"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}